<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>实证｜工具变量法的原理、使用和检验 | FGZ的主页</title><meta name="author" content="FGZ"><meta name="copyright" content="FGZ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="工具变量法并非特指 2SLS 估计，与其说是一种具体方法，更像是一种解决内生性问题的思路，许多方法都借鉴了 IV 的思路来解决潜在的内生性问题。 本文从工具变量的原理和选择入手，着重讨论怎么使用工具变量法、怎么检验工具变量的有效性。在文章的第五章，讨论了工具变量估计的外部有效性，该部分内容来自连享会。 一、工具变量法原理 1. 因果推断中的工具变量法 在因果推断中，为得到干预行为的净效应，干预行为">
<meta property="og:type" content="article">
<meta property="og:title" content="实证｜工具变量法的原理、使用和检验">
<meta property="og:url" content="https://fgzfgz.github.io/posts/32992/index.html">
<meta property="og:site_name" content="FGZ的主页">
<meta property="og:description" content="工具变量法并非特指 2SLS 估计，与其说是一种具体方法，更像是一种解决内生性问题的思路，许多方法都借鉴了 IV 的思路来解决潜在的内生性问题。 本文从工具变量的原理和选择入手，着重讨论怎么使用工具变量法、怎么检验工具变量的有效性。在文章的第五章，讨论了工具变量估计的外部有效性，该部分内容来自连享会。 一、工具变量法原理 1. 因果推断中的工具变量法 在因果推断中，为得到干预行为的净效应，干预行为">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fgzfgz.github.io/img/topimage.jpg">
<meta property="article:published_time" content="2025-04-28T10:03:17.000Z">
<meta property="article:modified_time" content="2025-07-26T14:49:55.990Z">
<meta property="article:author" content="FGZ">
<meta property="article:tag" content="实证分析">
<meta property="article:tag" content="Stata">
<meta property="article:tag" content="命令">
<meta property="article:tag" content="代码">
<meta property="article:tag" content="相关性">
<meta property="article:tag" content="工具变量">
<meta property="article:tag" content="工具变量检验">
<meta property="article:tag" content="遗漏变量">
<meta property="article:tag" content="近似外生工具变量">
<meta property="article:tag" content="外生性">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fgzfgz.github.io/img/topimage.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://fgzfgz.github.io/posts/32992/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.sukap.cn"/><meta name="google-site-verification" content="DWWqWjPUytI3RkNWoYmrVuQ0pENnG2IHC9YmqpYv-Is"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: '',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=true"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'true');
</script><link rel="stylesheet" href="https://fgzfgz.github.io" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '实证｜工具变量法的原理、使用和检验',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-26 22:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">91</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/BiliBili/"><i class="fa-fw fas fa-brands fa-bilibili"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Share/"><i class="fa-fw fas fa-solid fa-file-arrow-down"></i><span> 资源共享</span></a></li><li><a class="site-page child" href="/Favorites/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏集锦</span></a></li><li><a class="site-page child" href="/DataCleaning/"><i class="fa-fw fas fa-laptop"></i><span> 数据清洗</span></a></li><li><a class="site-page child" href="/EmpiRes/"><i class="fa-fw fas fa-chart-line"></i><span> 实证分析</span></a></li><li><a class="site-page child" href="/Data/"><i class="fa-fw fas fa-database"></i><span> 数据相关</span></a></li><li><a class="site-page child" href="/Economics/"><i class="fa-fw fas fa-solid fa-book-open"></i><span> 经济学笔记</span></a></li><li><a class="site-page child" href="/DevelopmentEconomics/"><i class="fa-fw fas fa-solid fa-book-open"></i><span> 发展经济学笔记</span></a></li><li><a class="site-page child" href="/Sustainable/"><i class="fa-fw fas fa-solid fa-seedling"></i><span> 可持续发展</span></a></li><li><a class="site-page child" href="/Opinion/"><i class="fa-fw fas fa-lightbulb"></i><span> 经济思考</span></a></li><li><a class="site-page child" href="/Software/"><i class="fa-fw fas fa-brands fa-uncharted"></i><span> 软件</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-solid fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/img/topimage.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="FGZ的主页"><span class="site-name">FGZ的主页</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/BiliBili/"><i class="fa-fw fas fa-brands fa-bilibili"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Share/"><i class="fa-fw fas fa-solid fa-file-arrow-down"></i><span> 资源共享</span></a></li><li><a class="site-page child" href="/Favorites/"><i class="fa-fw fas fa-bookmark"></i><span> 收藏集锦</span></a></li><li><a class="site-page child" href="/DataCleaning/"><i class="fa-fw fas fa-laptop"></i><span> 数据清洗</span></a></li><li><a class="site-page child" href="/EmpiRes/"><i class="fa-fw fas fa-chart-line"></i><span> 实证分析</span></a></li><li><a class="site-page child" href="/Data/"><i class="fa-fw fas fa-database"></i><span> 数据相关</span></a></li><li><a class="site-page child" href="/Economics/"><i class="fa-fw fas fa-solid fa-book-open"></i><span> 经济学笔记</span></a></li><li><a class="site-page child" href="/DevelopmentEconomics/"><i class="fa-fw fas fa-solid fa-book-open"></i><span> 发展经济学笔记</span></a></li><li><a class="site-page child" href="/Sustainable/"><i class="fa-fw fas fa-solid fa-seedling"></i><span> 可持续发展</span></a></li><li><a class="site-page child" href="/Opinion/"><i class="fa-fw fas fa-lightbulb"></i><span> 经济思考</span></a></li><li><a class="site-page child" href="/Software/"><i class="fa-fw fas fa-brands fa-uncharted"></i><span> 软件</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-solid fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">实证｜工具变量法的原理、使用和检验</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-28T10:03:17.000Z" title="发表于 2025-04-28 18:03">2025-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-26T14:49:55.990Z" title="更新于 2025-07-26 22:49">2025-07-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E8%AF%81%E5%88%86%E6%9E%90/">实证分析</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="实证｜工具变量法的原理、使用和检验"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>工具变量法并非特指 2SLS
估计，与其说是一种具体方法，更像是一种解决内生性问题的思路，许多方法都借鉴了
IV 的思路来解决潜在的内生性问题。</strong></p>
<p>本文从工具变量的原理和选择入手，着重讨论怎么使用工具变量法、怎么检验工具变量的有效性。在文章的第五章，讨论了工具变量估计的外部有效性，该部分内容来自连享会。</p>
<h2 id="一工具变量法原理">一、工具变量法原理</h2>
<h3 id="因果推断中的工具变量法">1. 因果推断中的工具变量法</h3>
<p>在因果推断中，为得到干预行为的净效应，干预行为 <span
class="math inline">\(D_i\)</span> 需满足条件独立性假设（Conditional
Independence Assumption, CIA）：</p>
<p><span class="math display">\[
\begin{align}
(Y_{0i},Y_{1i}) \perp D_i \  | \ X_i
\end{align}
\]</span></p>
<p>在满足条件独立性假设的前提下，使用 OLS 回归或者 PSM
都可以得到干预行为的净效应，即 ATT 或 ATE
。然而在现实中，受制于数据的可得性，遗漏变量问题无法避免，OLS 法和 PSM
估计难以满足 CIA
假设，通过添加变量来控制差异的做法可能无法得到真实的干预行为净效应。</p>
<p>例如在探究教育年限 <span class="math inline">\(D\)</span> 对收入
<span class="math inline">\(Y\)</span> 的影响时，学生的能力 <span
class="math inline">\(A\)</span>
可能是一种混杂因素，即学生的能力越强，其接受教育的年限可能越高，同时收入也可能会越大。传统
PSM
法估计无法解决学生能力等内部混杂因素与政策环境等外部混杂因素对因果识别结果的扭曲，这也是工具变量法区别于
PSM 的关键。</p>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/net-img-image-20221018182903-oq4blvn-20221021221423-dp6aln3.png" style="width:550px" alt="工具变量法的有相无环图" /></p>
<p>在工具变量法 (右图 b) 中，如有向无环图所示，如果存在一个工具变量
<span class="math inline">\(Z\)</span>
满足相关性与外生性的条件，就可以消除混杂因素 <span
class="math inline">\(A\)</span> 对结果的扭曲。</p>
<p><strong>工具变量的三个假设：</strong></p>
<ul>
<li><strong>相关性：</strong><span class="math inline">\(Cov(D_i, Z_i)
\ne 0\)</span>，即工具变量 <span class="math inline">\(Z\)</span>
与干预变量 <span class="math inline">\(D\)</span> 相关</li>
<li><strong>外生性：</strong><span class="math inline">\(Cov(\eta_i,
Z_i) = 0\)</span>，即工具变量与 <span class="math inline">\(Z\)</span>
与包含混杂因素 <span class="math inline">\(A\)</span> 的残差项 <span
class="math inline">\(\eta\)</span> 不相关，其中 <span
class="math inline">\(\eta_i = A^{&#39;}_i \gamma +v_i\)</span>。( <a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/541a6992f92b0.html"
title="工具变量的外部有效性">工具变量的外部有效性</a> )</li>
<li><strong>排他性：</strong> 工具变量 <span
class="math inline">\(Z_i\)</span> 仅能通过干预变量 <span
class="math inline">\(D_i\)</span> 影响 <span
class="math inline">\(Y_i\)</span>​</li>
</ul>
<p>（工具变量的假设其实只包含“相关性”和“外生性”，但是在实际检验过程中，由于外生性比较难直接检验，一些研究采取排除其他影响路径可能性的做法，用于检验“外生性”。“外生性”与“排他性”实质是相同的，但是在实际研究中，讨论和检验“外生性”的步骤往往更加简单，使用排他流程往往更加复杂。）</p>
<p><strong>工具变量可以消除混杂因素影响的原理是：</strong></p>
<p>阻断后门路径 <span class="math inline">\(D \leftarrow A \rightarrow
Y\)</span>，从其中分离出 <span class="math inline">\(D \rightarrow
Y\)</span>。</p>
<p>在实证中，为保证因果效应被准确识别，如果存在 <span
class="math inline">\(m\)</span> 个混杂因素，应当需要不少于 <span
class="math inline">\(m\)</span> 个工具变量。</p>
<h3 id="非因果推断中的工具变量法">2. 非因果推断中的工具变量法</h3>
<p>在因果推断中，常将干预变量 <span class="math inline">\(D_i\)</span>
设定为一个 0-1
变量，然而，干预变量为连续变量或多分类变量的情况更为常见。在连续变量和多分类变量的条件下，满足工具变量的三个假设，同样也可以用于模型中排除遗漏变量导致的估计偏误。</p>
<h2 id="二常用的工具变量">二、常用的工具变量</h2>
<p><strong>查看前的强烈推荐：</strong>​<strong><a
target="_blank" rel="noopener" href="https://sangmino.notion.site/1a897b8106ca44eeaf31dcd5ae5a61b1?v=ff7dc75862c6427eb4243e91836e077e">超过
1600 篇外文顶刊文章的工具变量汇总，还在动态更新!</a></strong></p>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/image-20240713164251-ygrl9iw.png" style="width:550px" alt="工具变量选择方法" /></p>
<p>来源：《<a target="_blank" rel="noopener" href="https://www.lianxh.cn/details/1351.html">IV
的标准动作：工具变量法实用指南</a>》，连享会</p>
<p>本节参考资料：<a
target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/H-HhAA89ITBhJYqJ3dokGw">计量经济圈推文</a></p>
<h3 id="截面数据中常用的工具变量">1. 截面数据中常用的工具变量</h3>
<h4 id="自然或地理特征">1.1 自然或地理特征</h4>
<p>由于经济系统的内生性很强，在许多研究中，为了规避内生性问题，会选择找看起来“严格外生”、不受经济系统干预和人类行为影响的变量作为工具变量。例如，天气、降水、温度（积温）、自然灾害、地形地貌、地理距离。</p>
<p>这类工具变量又可以分为两类：</p>
<ul>
<li><p>人类完全无法控制其变化的自然因素：天气、降水、温度（积温）、自然灾害等。这类工具变量受到质疑其外生性的可能性较小，但往往会受到研究主题限制，适用范围较小，需要严格根据选题来确定。</p></li>
<li><p>客观存在且很难改变的特征：地形地貌、地理距离（地理距离、驾车距离）等。</p>
<ul>
<li><strong>高程：</strong>
常用于研究基础设施建设、交通等内生变量的影响，认为高程不会（直接）影响经济发展等。然而城市扩张、经济发展往往优先在平原地区进行。高程并非严格外生。</li>
<li><strong>距离河流、山脉等自然地貌的地理距离：</strong>
与高程类似，地理距离往往不会直接影响经济系统，但是经济系统的构建往往依赖于自然地貌。看似地理距离也非严格外省。（例如：《科举万岁》的文章中，用到竹子产地的距离作为工具变量。）</li>
<li><strong>距离行政中心、经济中心的地理/驾车距离：</strong>
更加常用，与自然地貌相比，由于其目的地是行政中心、经济中心，这种影响路径更加复杂，距离本身可能也是影响结果变量的重要因素。</li>
</ul></li>
</ul>
<p>虽然这么说，但是还是值得计算到行政中心/经济中心的距离。可以使用<a
target="_blank" rel="noopener" href="https://lbs.amap.com/">高德地图</a>或<a
target="_blank" rel="noopener" href="https://lbsyun.baidu.com/">百度地图</a>的开发者账号，通过指定的函数计算出需要的内容。</p>
<ul>
<li>获取开发者账号权限，获得秘钥</li>
<li>使用软件输入格式化的函数（<a
target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78690883">教程链接</a>），在函数对应位置填写秘钥</li>
<li>根据出发地和目的地的地址名称，调用地图平台的
api，计算出出发地和目的地的经纬度</li>
<li>基于两个经纬度，自动计算导航距离/时间。</li>
</ul>
<h3 id="关联特征">1.2 关联特征</h3>
<h4 id="与内生变量关联">1.2.1 <strong>与内生变量关联</strong></h4>
<p><strong>案例 1：与制度相关的教会（文化影响）</strong>​<strong><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzYwGnP_B8U6D6h8_ragH3bE2wjW3c1tFmlCAPihgNWuyUGlYEEFYLipsz-UtVr0INCnTMsjmm2yW16zh47hwtm2tBYj1waH6CUwiH7xBpwb3MTUHJb77c0cP1KjJv65oTMggBvQSbT9_A==&amp;uniplatform=NZKPT&amp;language=CHS">知网链接</a></strong></p>
<p>方颖和赵扬(2011)在各地产权保护制度对经济增长影响的研究中，将 1919
年中国不同城市基督教初级教会小学注册人数占当地人口比例作为工具变量，主要原因是，该比例可在一定程度上代表在历史上该地区受西方影响的程度，入读教会小学的比例越高，表明该地区受西方影响越大，建立产权保护制度的意识较强，而建立教会小学的初衷是布道，与经济发展水平并不直接相关。</p>
<p><strong>案例 2：与历史相关的基础设施（地理位置）</strong>​<strong><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzb96n2ec0eniPtcX8wZi7cLq__yvibfJ6Ae54-QzOS0NYqKlq-YNXMksmEBiOiIKMH_zrLelOQ_l0qFS0LUE7OdkaJ_Iq-Qa0I0b8VkE0enXZDVaApWuhK3N5jKKaUDoiagFGfd-AkcrrRigGWRCXf_&amp;uniplatform=NZKPT&amp;language=CHS">知网链接</a></strong></p>
<p>谭伟杰等（2024）在政府数字采购政策对企业商业信用融资能力的影响的研究中，使用明朝驿站和时间趋势项的交互项作为工具变量。原因是驿站往往建在古代信息条件好、通讯基础设施更加完善的地区，驿站数量与当代的数字经济有正向关联；但是，古代驿站建设主要出于军事考虑，与企业的商业信用关联较小。</p>
<h4 id="与受访个体关联">1.2.2 <strong>与受访个体关联</strong></h4>
<p><strong>家庭内关联：</strong>
子女的教育程度与父母的挂钩，用父母的教育教育程度作为工具变量；用双胞胎另一个孩子的情况作为工具变量。</p>
<p><strong>区域内关联：</strong>
邻居的情况，邻居是否加入合作社，会影响受访者的加入意愿。</p>
<h4 id="同侪效应">1.3 同侪效应</h4>
<p>同侪效应是一种特殊额度关联个体的指标。</p>
<p><strong>同侪效应 / 同伴效应 / 伙伴效应：</strong>
同一组内其他样本的行为或状态可能会影响受访者的行为与状态。</p>
<p>同侪效应常用作工具变量，原因是：本组内其他样本的行为和状态会对受访者产生影响，但是并不会直接影响受访者的结果变量
<span class="math inline">\(y_i\)</span>。</p>
<p>假设某一组内共有 <span class="math inline">\(m\)</span>
个样本，对于受访者 <span class="math inline">\(i\)</span>​，其同侪效应
$X_p $ (组内其他样本均值) 可以表示为：</p>
<p><span class="math display">\[
\begin {align}
X_p= \frac {\sum _{j \ne i} X_j} {m-1}
= \frac {\sum _{j =1}^n X_j \ - \ X_i} {m-1}
\end{align}
\]</span></p>
<p>计算步骤包括：</p>
<ul>
<li>计算组内样本数量 <span class="math inline">\(m\)</span>；</li>
<li>计算组内所有样本变量 <span class="math inline">\(X\)</span>
的取值之和；</li>
<li>代入上式计算同侪效应 <span class="math inline">\(X_p\)</span>。</li>
</ul>
<p>因此，可以按如下过程计算：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 使用 count 和 total 函数:</span></span><br><span class="line"><span class="keyword">egen</span> count_num=<span class="keyword">count</span>(X), <span class="keyword">by</span>(CID)    <span class="comment">// 分组计算变量 X 的非缺失值样本数量</span></span><br><span class="line"><span class="keyword">egen</span> X_total=<span class="keyword">total</span>(X), <span class="keyword">by</span>(CID)      <span class="comment">// 对 X 的分组求和</span></span><br><span class="line"><span class="keyword">gen</span> X_p=(X_total-X)/(count_num-1)</span><br></pre></td></tr></table></figure>
<p>上述计算过程比较麻烦，也有学者开发了 <code>peers</code>​
函数，可以等效替代上面的命令：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 使用 peers 函数: 以 CID 分组, 组内其他受访者的 X 均值</span></span><br><span class="line"><span class="keyword">ssc</span> install _peers, <span class="keyword">replace</span>       <span class="comment">//安装 peers 函数，仅首次使用需要安装</span></span><br><span class="line"><span class="keyword">egen</span> X_peers=peers(X), <span class="keyword">by</span>(CID)             <span class="comment">//CID 为分组变量, 包含 X 为缺失值的样本</span></span><br></pre></td></tr></table></figure>
<p><code>peers</code>​
函数对存在缺失值的情况应对并不好，因此需要做一点小处理。即确保分组的
<code>CID</code>​ 和待计算的 <code>X</code>​ 不能是缺失值：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">egen</span> X_peers=peers(X) <span class="keyword">if</span> X!=. &amp; CID!=., <span class="keyword">by</span>(CID)</span><br></pre></td></tr></table></figure>
<h3 id="面板数据中常用的工具变量">2. 面板数据中常用的工具变量</h3>
<h4 id="时变变量作工具变量">2.1 时变变量作工具变量</h4>
<p><strong>自然因素、地理特征或外部冲击：</strong></p>
<p>《<a
target="_blank" rel="noopener" href="https://www.journals.uchicago.edu/doi/abs/10.1086/715590?journalCode=jop">农业比较优势与立法者对贸易协定的支持</a>》农业比较优势对贸易协定的影响，天气与土壤因素作为工具变量，属于外生自然因素。</p>
<p>《<a
target="_blank" rel="noopener" href="https://www.nber.org/papers/w31594">警察知道该拦截谁吗？</a>》美国警察拦截车辆或者行人，检验检查点数量对犯罪率的影响，工具变量是
COVID-19 和 George Floyd
遇害后全国抗议活动，这两个外生的事件爆发导致了检查点增加，但并没有降低犯罪率。</p>
<p><strong>内生变量的滞后项：</strong></p>
<p>《<a
target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/abs/pii/S0140988321002887">超越大火：森林火灾对能源贫困的影响</a>》滞后的森林火灾作为工具变量。</p>
<h4 id="非时变变量作工具变量">2.2 非时变变量作工具变量</h4>
<p><strong>非时变变量往往无法直接作为工具变量，常见做法是和时变变量作交互项，构成时变的工具变量。</strong></p>
<p><strong>做法一：非时变变量与时间趋势的交互项</strong></p>
<p><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzb96n2ec0eniPtcX8wZi7cLq__yvibfJ6Ae54-QzOS0NYqKlq-YNXMksmEBiOiIKMH_zrLelOQ_l0qFS0LUE7OdkaJ_Iq-Qa0I0b8VkE0enXZDVaApWuhK3N5jKKaUDoiagFGfd-AkcrrRigGWRCXf_&amp;uniplatform=NZKPT&amp;language=CHS">谭伟杰等（2024）</a>在政府数字采购政策对企业商业信用融资能力的影响的研究中，使用明朝驿站和时间趋势项的交互项作为工具变量。原因是驿站往往建在古代信息条件好、通讯基础设施更加完善的地区，驿站数量与当代的数字经济有正向关联；但是，古代驿站建设主要出于军事考虑，与企业的商业信用关联较小。</p>
<p><strong>做法二：非时变变量与时变变量的交互项</strong></p>
<p><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzZPH5kFgbPsJD9PAtUaeJ8QCI_taiwBkwrGuZLwKvhqnP4qUx0VxUh3QdSBYO3ZHKBROwa0OvO4x8vp2GY3capqyowfFihVSYgANhbjb0thPS2Yb7qclh5OjGkkMALNvKeT9kwDyOnPBg==&amp;uniplatform=NZKPT&amp;language=CHS">任劼（2024）</a>探究营商环境对城乡收入差距的影响，参考<a
target="_blank" rel="noopener" href="https://www.aeaweb.org/articles?id=10.1257/aer.104.6.1630">Nunn
&amp; Qian（2014）</a>的做法，引入一个随时间变
化的变量——当地普通高等学校人数的滞后一期，与 2007
年财产保险的赔付支出相乘构造交互项
组成面板数据，形成营商环境的最终工具变量。</p>
<h2 id="三常用的工具变量法">三、常用的工具变量法</h2>
<h3 id="基于两步估计的工具变量法">1. 基于两步估计的工具变量法</h3>
<h4 id="最为常见的两阶段估计两阶段最小二乘法2sls">1.1
最为常见的两阶段估计：两阶段最小二乘法（2SLS）</h4>
<p><span class="math display">\[
\begin{align}
x_i &amp;= \gamma z_i + \lambda w_i + \xi_i  \\
y_i &amp;= \beta \hat x_i + \delta w_i + \mu_i
\end{align}
\]</span></p>
<p>2SLS 的本质是将第一阶段计算出的工具变量 <span
class="math inline">\(z_i\)</span> 对内生变量 <span
class="math inline">\(x_i\)</span> 的拟合值 <span
class="math inline">\(\hat x_i\)</span>，代入第二阶段，用拟合值 <span
class="math inline">\(\hat x_i\)</span> 对 <span
class="math inline">\(y_i\)</span> 的估计系数进行替代。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 最常见的2SLS</span></span><br><span class="line">ivregress 2sls y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>), r</span><br><span class="line"><span class="comment">** 对弱工具变量更不敏感的LIML(有限信息最大似然法)</span></span><br><span class="line">ivregress liml y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>), r</span><br><span class="line"><span class="comment">** 如果存在异方差, 用gmm估计比2sls更有效率</span></span><br><span class="line">ivregress gmm y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>)</span><br></pre></td></tr></table></figure>
<h4 id="两阶段模型的修正与补充2sps-与-2sri">1.2
两阶段模型的修正与补充：2SPS 与 2SRI</h4>
<p><strong>推荐阅读：</strong> <a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzYrUgQrir9hfnlRovRrfAFci4ESQpFVDHJgUc_AxYgcsbQY6_zjz5LdRsDXMyW3DPLDiPOrrTJC7DzoK0M-0FQoJjljRn6cidyM9c2pzGVacHj2hKv7SLpnFjk_K88abNWclQTOyYi9RfqJgxkPxRWJ&amp;uniplatform=NZKPT&amp;language=CHS">赵娜,洪广彬.多项分布内生回归元计数模型的两阶段估计方法研究[J].统计与信息论坛,2018,33(08):19-30.</a></p>
<p>2SPS（Two-stage Predictor Substitution, 两阶段预测值替代估计）与 2SLS
类似，都是在第一阶段工具变量对内生变量进行估计，得到拟合值替代内生变量进行第二阶段估计（<a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzZ017R8nEj1kbQ5yJs5TS-u12pe10RHCGTfdt3XG4KvMdmeZmswINmPOr97KTQL7PaMTEAaZ3TLw8eTz6wyFveLehQHBp1f4EMFAT5B4n6pxHRoevIueLf7N7Wx2T8VtfhXy7_4AmuFxA==&amp;uniplatform=NZKPT&amp;language=CHS">杨玉萍，2014</a>）。但是随着计量经济学的发展和微观统计数据的完善，现代社会科学领域的经验性研究越来越多地开始使用非线性计量模型，如离散选择模型、计数模型和受限因变量模型等。当内生变量为服从某一特定分布的离散型变量时，忽略内生变量的特殊性质而仍然采用
2SLS 法，就会导致非一致的参数估计量（<a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzYrUgQrir9hfnlRovRrfAFci4ESQpFVDHJgUc_AxYgcsbQY6_zjz5LdRsDXMyW3DPLDiPOrrTJC7DzoK0M-0FQoJjljRn6cidyM9c2pzGVacHj2hKv7SLpnFjk_K88abNWclQTOyYi9RfqJgxkPxRWJ&amp;uniplatform=NZKPT&amp;language=CHS">赵娜、洪广彬，2018</a>）。</p>
<h4 id="两阶段残差包含法twostage-residual-inclusion-2sri">1.3
两阶段残差包含法（Twostage Residual Inclusion, 2SRI）</h4>
<p><span class="math display">\[
\begin{align}
x_i &amp;= \gamma z_i + \lambda w_i + \xi_i    \\
y_i &amp;= \beta x_i +  \delta w_i + \hat R_i  + \mu_i
\end{align}
\]</span></p>
<p>2SRI 本质是将第一阶段得到的估计残差 <span class="math inline">\(\hat
R_i\)</span> 代入第二阶段，以消除内生性影响。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li>2SRI 模型没有集成的命令包，需要手动调整变量和参数。</li>
<li>2SRI 模型涉及矩阵运算，在使用前需要确保模型使用到的所有变量（<span
class="math inline">\(y_i\)</span>、<span
class="math inline">\(x_i\)</span>、<span
class="math inline">\(z_i\)</span> 和控制变量 <span
class="math inline">\(w_i\)</span>）均没有缺失值。</li>
<li>2SRI
的第一阶段估计和第二阶段估计的控制变量需要完全相同，否则无法进行矩阵运算。</li>
</ul>
<p><strong>模型优点：</strong></p>
<ul>
<li>可以通过第一阶段估计模型的设定，针对内生变量不同分布选择 2SRI
类型</li>
<li>当模型存在忽略模型非线性、内生性或错误设定计数数据分布时，2SLS 和
2SPS 会存在较大的估计偏差，但 2SRI 具有良好的有限样本特性（<a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzYrUgQrir9hfnlRovRrfAFci4ESQpFVDHJgUc_AxYgcsbQY6_zjz5LdRsDXMyW3DPLDiPOrrTJC7DzoK0M-0FQoJjljRn6cidyM9c2pzGVacHj2hKv7SLpnFjk_K88abNWclQTOyYi9RfqJgxkPxRWJ&amp;uniplatform=NZKPT&amp;language=CHS">赵娜、洪广彬，2018</a>）</li>
</ul>
<p><strong>2SRI 的用法可以参考下面的文章：</strong></p>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/10.1177/1536867X1601600206">Terza
J V. Simpler standard errors for two-stage optimization estimators[J].
The Stata Journal, 2016, 16(2): 368-385.</a></li>
<li><a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/abs/10.1177/1536867X1801700409">Terza
J V. Two-stage residual inclusion estimation: A practitioners guide to
Stata implementation[J]. The Stata Journal, 2017, 17(4):
916-938.</a></li>
</ol>
<h3 id="内生转换模型-esr">2. 内生转换模型 ESR</h3>
<p>在截面数据中，当内生变量 <span class="math inline">\(x_i\)</span>
为二分类变量时，例如“是否加入合作社”，可以使用内生转换模型处理内生性问题。根据结果变量
<span class="math inline">\(y_i\)</span>
的类型不同，应当使用不同的内生转换模型。</p>
<ul>
<li><span class="math inline">\(y_i\)</span>
为二分变量，使用内生转换概率模型（ESP），使用 <code>switch_probit</code>
命令即可实现</li>
<li><span class="math inline">\(y_i\)</span>
为连续变量，使用内生转换回归模型（ESR），使用 <code>movestay</code>
命令即可实现</li>
</ul>
<p><strong>拓展链接：</strong></p>
<ul>
<li><p><a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/3b3bfdad7e106.html">连享会：内生转换模型及其应用-movestay-mspredict</a></p></li>
<li><p>多项内生转换模型（MESR）的两篇文章：</p>
<ul>
<li>代码复现：Khonje M G, Manda J, Mkandawire P, et al. <a
target="_blank" rel="noopener" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/agec.12445">Adoption
and welfare impacts of multiple agricultural technologies: evidence from
eastern Zambia</a>[J]. Agricultural Economics, 2018, 49(5):
599-609.</li>
<li>使用<code>selmlog</code>​和<code>mtreatreg</code>​估计ATT：Amankwah A,
Gwatidzo T.<a
target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S030691922400040X">Food
security and poverty reduction effects of agricultural technologies
adoption− a multinomial endogenous switching regression application in
rural Zimbabwe</a>[J]. Food Policy, 2024, 125: 102629.</li>
</ul></li>
</ul>
<h3 id="拓展回归模型-erm">3. 拓展回归模型 ERM</h3>
<p><strong>需要明确的是：拓展回归模型 ERM
是一类模型，不是一个具体的模型。</strong></p>
<p><strong>拓展回归模型“拓展”了什么？</strong></p>
<ul>
<li><strong>拓展的模型种类：</strong> 相对
<code>regress</code>​、<code>probit</code>​
、<code>oprobit</code>​、<code>logit</code>​、<code>tobit</code>​、<code>intreg</code>​
等基础模型的内生性拓展</li>
<li><strong>拓展内生性：</strong>
与常用的解决内生性的模型可以得到相同的估计结果，但在多内生变量、工具变量等情形下，可以设置不同的工具变量和控制变量，得到不同的估计结果</li>
<li><strong>拓展样本选择：</strong> 解决样本选择问题</li>
<li><strong>拓展处理效应：</strong>
添加处理效应模块，可以计算非随机条件下的处理效应</li>
<li><strong>检验值：</strong> 自动汇报比常规模型更多的检验值</li>
</ul>
<p>以 <code>reg</code> ​的拓展 <code>eregress</code> ​为例：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 内生协变量 (Basic linear regression with endogenous covariates)</span></span><br><span class="line">eregress y [indepvars], endogenous(depvars_en = varlist_en)   <span class="comment">// _en后缀为内生变量, indepvars 与varlist_en可以相同, 也可以不同</span></span><br><span class="line"></span><br><span class="line"><span class="comment">** 内生处理效应 (Basic linear regression with endogenous treatment assignment)</span></span><br><span class="line">eregress y [indepvars], entreat(depvar_tr [= varlist_tr])    <span class="comment">// _tr 后缀为内生处理变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">** 外生处理效应 (Basic linear regression with exogenous treatment assignment)</span></span><br><span class="line">eregress y [indepvars], extreat(tvar)                      <span class="comment">// tvar 处理变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">** 样本选择问题 (Basic linear regression with sample selection)</span></span><br><span class="line">eregress y [indepvars], select(depvar_s = varlist_s)       <span class="comment">// _s 后缀为样本选择变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">** 内生协变量 + 处理效应 + 样本选择</span></span><br><span class="line">eregress y [indepvars] [, extensions options]</span><br></pre></td></tr></table></figure>
<p>以 <code>xtreg</code> ​的扩展 <code>xtregress</code> ​为例：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 随机效应模型 (Basic linear regression with random effects)</span></span><br><span class="line">xteregress y [indepvars] [, options]</span><br><span class="line"></span><br><span class="line"><span class="comment">** 随机效应 + 内生协变量 + 处理效应 + 样本选择</span></span><br><span class="line">xteregress y [indepvars] [, extensions options]</span><br></pre></td></tr></table></figure>
<h3 id="其他工具变量法">4. 其他工具变量法</h3>
<p><strong>放松假设、对原有扩展模型扩展：</strong></p>
<ul>
<li>不可识别情况下的工具变量估计：<code>mmeiv</code>​，<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/0ae09a74e477f.html">工具变量数量少于内生变量数量时的估计方法</a></li>
<li>连享会-常用工具变量法的介绍：<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/details/1351.html">链接</a>，例如：结构方程模型
SEM、增广回归（augmented regression，如：控制函数法 CF）</li>
<li>多个(弱)工具变量的估计方法：<code>mivreg</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/10.1177/1536867X19893627?icid=int.sj-full-text.similar-articles.3">Anatolyev
S, Skolkova A. Many instruments: Implementation in Stata[J]. The Stata
Journal, 2019, 19(4): 849-866.</a>，<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/807b616b11aae.html">连享会链接</a></li>
<li>无需工具变量的内生性问题处理（敏感性分析）：<code>kinkreg</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/full/10.1177/1536867X211045575">Kripfganz
S, Kiviet J F. kinkyreg: Instrument-free inference for linear regression
models with endogenous regressors[J]. The Stata Journal, 2021, 21(3):
772-813.</a></li>
</ul>
<p><strong>工具变量方法在其他模型、数据的应用：</strong></p>
<ul>
<li>带有工具变量的因果中介分析：<code>ivmediate</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/full/10.1177/1536867X20953572">Dippel
C, Ferrara A, Heblich S. Causal mediation analysis in
instrumental-variables regressions[J]. The Stata Journal, 2020, 20(3):
613-626.</a>j</li>
<li>基于多中心随机试验的中介变量工具变量法：<a
target="_blank" rel="noopener" href="https://www.jstor.org/stable/43966330">Reardon S F, Unlu F, Zhu P,
et al. Bias and bias correction in multisite instrumental variables
analysis of heterogeneous mediator effects[J]. Journal of Educational
and Behavioral Statistics, 2014, 39(1): 53-86.</a></li>
<li>截断数据的工具变量法：<code>ivtobit</code>​，<a
target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S0304407623000258">Chesher
A, Kim D, Rosen A M. IV methods for Tobit models[J]. Journal of
Econometrics, 2023, 235(2): 1700-1724.</a></li>
<li>2SLS 和 GMM 估计的扩展工具变量回归：<code>ivreg2</code>​，<a
target="_blank" rel="noopener" href="https://econpapers.repec.org/software/bocbocode/s4254010.htm">IVREG2:
Stata module for extended instrumental variables/2SLS and GMM
estimation</a></li>
<li>工具变量处理效应模型：<code>ivtreatreg</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400301">Cerulli
G. ivtreatreg: A command for fitting binary treatment models with
heterogeneous response to treatment and unobservable selection[J]. The
Stata Journal, 2014, 14(3): 453-480.</a></li>
<li>基于工具变量的平滑分位数估计：<code>sivqr</code>​，Kaplan D M, Sun Y.
Smoothed estimating equations for instrumental variables quantile
regression[J]. Econometric Theory, 2017, 33(1): 105-157.，<a
target="_blank" rel="noopener" href="https://www.cambridge.org/core/journals/econometric-theory/article/abs/smoothed-estimating-equations-for-instrumental-variables-quantile-regression/59EE6581C077098DDBB87F3E98F9BF90">原理</a>、<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/abs/10.1177/1536867X221106404">代码使用</a></li>
<li>删失或未删失数据的工具变量分位数回归：<code>cqiv</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/10.1177/1536867X19893615">Chernozhukov
V, Fernández-Val I, Han S, et al. Censored quantile
instrumental-variable estimation with Stata[J]. The Stata Journal, 2019,
19(4): 768-781.</a></li>
<li>基于面板数据的工具变量分位数回归：<a
href="file:///C:/Users/wugan/Documents/wugang/zotero/storage/XAPZAU4E/S0165176509001554.html">Harding
M, Lamarche C. A quantile regression approach for estimating panel data
models using instrumental variables[J]. Economics Letters, 2009, 104(3):
133-135.</a></li>
<li>两阶段面板工具变量估计：<code>xtivdfreg</code>​，<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/10.1177/1536867X211045558">Kripfganz
S, Sarafidis V. Instrumental-variable estimation of large-T panel-data
models with common factors[J]. The Stata Journal, 2021, 21(3):
659-686.</a>，<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/details/1229.html">连享会链接</a></li>
<li>工具变量在门槛回归中的应用：<a
target="_blank" rel="noopener" href="https://www.cambridge.org/core/journals/econometric-theory/article/abs/instrumental-variable-estimation-of-a-threshold-model/E5BF8D1E8498E3FB578A053C330CB4FD">Caner
M, Hansen B E. Instrumental variable estimation of a threshold model[J].
Econometric theory, 2004, 20(5): 813-843.</a></li>
<li>基于非参数估计的时变系数工具变量法：<a
target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/abs/pii/S0304407620303754">Giraitis
L, Kapetanios G, Marcellino M. Time-varying instrumental variable
estimation[J]. Journal of Econometrics, 2021, 224(2): 394-415.</a></li>
</ul>
<h2 id="四工具变量的检验">四、工具变量的检验</h2>
<h3 id="常见检验项目四大项目">1. 常见检验项目：四大项目</h3>
<p><strong>豪斯曼检验（Hausman test）：</strong>
检验解释变量内生性，需要同方差假设，因此不能使用稳健标准误</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">qui</span> <span class="keyword">reg</span> y x <span class="variable">$varlist1</span></span><br><span class="line"><span class="keyword">est</span> store ols </span><br><span class="line"><span class="keyword">qui</span> ivregress 2sls y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>)</span><br><span class="line"><span class="keyword">est</span> store iv </span><br><span class="line"><span class="keyword">hausman</span> iv ols, constant sigmamore</span><br></pre></td></tr></table></figure>
<p><strong>不可识别检验（Underidentification test）：</strong>
使用工具变量法的前提之一是秩条件成立，即 <span
class="math inline">\(L\)</span> 个工具变量的秩为 <span
class="math inline">\(z_i\)</span>，<span
class="math inline">\(K\)</span> 个内生变量（解释变量）的秩为 <span
class="math inline">\(x_i\)</span>，那么要求 <span
class="math inline">\(z_i\)</span> 与 <span
class="math inline">\(x_i\)</span> 有重叠元素，且 <span
class="math inline">\(L &gt;=
K\)</span>。对于不满足列满秩的情况，可以使用 <code>ivreg2</code>​
命令进行检验，可以查看 <strong>Kleibergen-Parp rk LM
统计量</strong>。</p>
<p><strong>弱工具变量检验（Weak instruments test）：</strong>
如果内生变量与工具变量的仅微弱相关，工具变量中与内生变量相关的信息很少，就会存在弱工具变量问题，可以使用四种方法判别：</p>
<ul>
<li>方法一：偏 R<sup>2</sup>（Shea's partial
R<sup>2</sup>），Shea（1997）提出</li>
<li>方法二：最小特征值统计量（minimum eigenvalue statistics），Stock and
Yogo（2005）提出。在只有一个内生解释变量的条件下，该统计量还原为 F
统计量</li>
<li>方法三：假设扰动项独立同分布（iid），使用 Cragg-Donald Wald F
统计量（Cragg and Donald，2005），临界值由 Stock and
Yogo（2005）提供</li>
<li>方法四：如果扰动项不满足 iid 假设，使用 Kleibergen-Paap Wald rk F
统计量，临界值来自 Stock and Yogo（2005）</li>
<li>其他检验方法：弱工具变量检验：<code>twostepweakiv</code>​，<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/2e36ddefa9f76.html">使用两步法检验线性工具变量估计中工具变量的稳健性</a></li>
</ul>
<p><strong>过度识别检验（Overidentification test）：</strong>
工具变量比内生变量多，则需要做过度识别检验。原假设：“<em>H</em>​<em><sub>0</sub></em>：所有工具变量都是外生的”。</p>
<h4 id="命令">1.1 <strong>命令：</strong></h4>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 在ivregress 2SLS下的弱工具变量检验</span></span><br><span class="line">ivregress 2sls y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>), r</span><br><span class="line"><span class="keyword">estat</span> firststage, all forcenonrobust</span><br><span class="line"><span class="keyword">estat</span> overid</span><br><span class="line"></span><br><span class="line"><span class="comment">** 在ivreg2下的弱工具变量检验</span></span><br><span class="line">ivreg2 y <span class="variable">$varlist1</span> (x = <span class="variable">$ivlist</span>), r</span><br></pre></td></tr></table></figure>
<h4 id="ivregress-2sls-下的工具变量检验示例">1.2
<strong>​<code>ivregress 2SLS</code>​</strong>​
<strong>下的工具变量检验示例：</strong></h4>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 案例数据: 陈强《高级计量》案例数据, 链接: https://fgzfgz.github.io/posts/16796/</span></span><br><span class="line"><span class="keyword">use</span> grilic, <span class="keyword">clear</span></span><br><span class="line">ivregress 2sls lw s expr tenure rns smsa (iq = med kww mrt age), r</span><br><span class="line"></span><br><span class="line"><span class="comment">** 1. 弱工具变量</span></span><br><span class="line"><span class="keyword">estat</span> firststage, all forcenonrobust</span><br><span class="line"><span class="comment">/*  First-stage regression summary statistics</span></span><br><span class="line"><span class="comment">  --------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">               |            Adjusted      Partial       Robust</span></span><br><span class="line"><span class="comment">      Variable |   R-sq.       R-sq.        R-sq.      F(4,748)   Prob &gt; F</span></span><br><span class="line"><span class="comment">  -------------+------------------------------------------------------------</span></span><br><span class="line"><span class="comment">            iq |  0.3175      0.3093       0.0533       9.58518    0.0000</span></span><br><span class="line"><span class="comment">  --------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Shea&#x27;s partial R-squared     // 弱工具变量方法一</span></span><br><span class="line"><span class="comment">  --------------------------------------------------</span></span><br><span class="line"><span class="comment">               |     Shea&#x27;s             Shea&#x27;s</span></span><br><span class="line"><span class="comment">      Variable |  partial R-sq.   adj. partial R-sq.</span></span><br><span class="line"><span class="comment">  -------------+------------------------------------</span></span><br><span class="line"><span class="comment">            iq |     0.0533             0.0432</span></span><br><span class="line"><span class="comment">  --------------------------------------------------</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Minimum eigenvalue statistic = 10.5383    // 弱工具变量方法二  </span></span><br><span class="line"><span class="comment">  Critical Values                      # of endogenous regressors:    1</span></span><br><span class="line"><span class="comment">  H0: Instruments are weak             # of excluded instruments:     4</span></span><br><span class="line"><span class="comment">  ---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">                                     |    5%     10%     20%     30%</span></span><br><span class="line"><span class="comment">  2SLS relative bias                 |  16.85   10.27    6.71    5.34</span></span><br><span class="line"><span class="comment">  -----------------------------------+---------------------------------</span></span><br><span class="line"><span class="comment">                                     |   10%     15%     20%     25%</span></span><br><span class="line"><span class="comment">  2SLS size of nominal 5% Wald test  |  24.58   13.96   10.26    8.31</span></span><br><span class="line"><span class="comment">  LIML size of nominal 5% Wald test  |   5.44    3.87    3.30    2.98</span></span><br><span class="line"><span class="comment">  ---------------------------------------------------------------------   */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">** 2. 过度识别检验</span></span><br><span class="line"><span class="keyword">estat</span> overid</span><br><span class="line"><span class="comment">/* Test of overidentifying restrictions:</span></span><br><span class="line"><span class="comment">  Score chi2(3)          =  51.5449  (p = 0.0000)  */</span></span><br></pre></td></tr></table></figure>
<h4 id="ivreg2-下的工具变量检验示例">1.3
<strong>​<code>ivreg2</code>​</strong>​
<strong>下的工具变量检验示例：</strong></h4>
<p>使用 <code>ivreg2</code>​ 可以直接汇报更多的检验结果：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">** 案例数据: 陈强《高级计量》案例数据, 链接: https://fgzfgz.github.io/posts/16796/</span></span><br><span class="line"><span class="keyword">use</span> grilic, <span class="keyword">clear</span></span><br><span class="line">ivreg2 lw s expr tenure rns smsa (iq = med kww mrt age), r</span><br><span class="line"></span><br><span class="line"><span class="comment">** 1. 弱工具变量检验</span></span><br><span class="line"><span class="comment">/* Estimates efficient for homoskedasticity only</span></span><br><span class="line"><span class="comment">Statistics robust to heteroskedasticity</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                                                      Number of obs =      758</span></span><br><span class="line"><span class="comment">                                                      F(  6,   751) =    58.74</span></span><br><span class="line"><span class="comment">                                                      Prob &gt; F      =   0.0000</span></span><br><span class="line"><span class="comment">Total (centered) SS     =  139.2861498                Centered R2   =   0.2002</span></span><br><span class="line"><span class="comment">Total (uncentered) SS   =  24652.24662                Uncentered R2 =   0.9955</span></span><br><span class="line"><span class="comment">Residual SS             =    111.39959                Root MSE      =    .3834</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">             |               Robust</span></span><br><span class="line"><span class="comment">          lw | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]</span></span><br><span class="line"><span class="comment">-------------+----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">          iq |  -.0115468   .0056376    -2.05   0.041    -.0225962   -.0004974</span></span><br><span class="line"><span class="comment">           s |   .1373477   .0174989     7.85   0.000     .1030506    .1716449</span></span><br><span class="line"><span class="comment">        expr |   .0338041   .0074844     4.52   0.000      .019135    .0484732</span></span><br><span class="line"><span class="comment">      tenure |    .040564   .0095848     4.23   0.000     .0217781      .05935</span></span><br><span class="line"><span class="comment">         rns |  -.1176984   .0359582    -3.27   0.001    -.1881751   -.0472216</span></span><br><span class="line"><span class="comment">        smsa |    .149983   .0322276     4.65   0.000     .0868182    .2131479</span></span><br><span class="line"><span class="comment">       _cons |   4.837875   .3799432    12.73   0.000       4.0932     5.58255</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">Underidentification test (Kleibergen-Paap rk LM statistic):             33.294    // 不可识别检验</span></span><br><span class="line"><span class="comment">                                                   Chi-sq(4) P-val =    0.0000</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">Weak identification test (Cragg-Donald Wald F statistic):               10.538    // 弱工具变量方法三</span></span><br><span class="line"><span class="comment">                         (Kleibergen-Paap rk Wald F statistic):          9.585    // 弱工具变量方法四</span></span><br><span class="line"><span class="comment">Stock-Yogo weak ID test critical values:  5% maximal IV relative bias    16.85</span></span><br><span class="line"><span class="comment">                                         10% maximal IV relative bias    10.27</span></span><br><span class="line"><span class="comment">                                         20% maximal IV relative bias     6.71</span></span><br><span class="line"><span class="comment">                                         30% maximal IV relative bias     5.34</span></span><br><span class="line"><span class="comment">                                         10% maximal IV size             24.58</span></span><br><span class="line"><span class="comment">                                         15% maximal IV size             13.96</span></span><br><span class="line"><span class="comment">                                         20% maximal IV size             10.26</span></span><br><span class="line"><span class="comment">                                         25% maximal IV size              8.31</span></span><br><span class="line"><span class="comment">Source: Stock-Yogo (2005).  Reproduced by permission.</span></span><br><span class="line"><span class="comment">NB: Critical values are for Cragg-Donald F statistic and i.i.d. errors.</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">Hansen J statistic (overidentification test of all instruments):        51.545    // 过度识别检验</span></span><br><span class="line"><span class="comment">                                                   Chi-sq(3) P-val =    0.0000</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">Instrumented:         iq</span></span><br><span class="line"><span class="comment">Included instruments: s expr tenure rns smsa</span></span><br><span class="line"><span class="comment">Excluded instruments: med kww mrt age</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------   */</span></span><br></pre></td></tr></table></figure>
<h3 id="工具变量的假设检验">2.工具变量的假设检验</h3>
<h4 id="截面数据的工具变量假设检验">2.1 截面数据的工具变量假设检验</h4>
<h5 id="相关性的假设检验">2.1.1 <strong>相关性的假设检验</strong></h5>
<p>含义：内生变量 <span class="math inline">\(x\)</span> 与工具变量
<span class="math inline">\(z\)</span> 之间有关联，而且非弱关联。</p>
<ul>
<li>使用弱工具变量检验结果论证内生变量 <span
class="math inline">\(x\)</span> 与工具变量 <span
class="math inline">\(z\)</span> 之间的关系不是弱关联</li>
<li>回归法：构建 <span class="math inline">\(z\)</span> 对 <span
class="math inline">\(x\)</span> 的简单 OLS
回归，例如：<code>reg x z</code>​</li>
<li>第一阶段回归结果：两步估计（2SLS、2SPS、2SRI）第一阶段工具变量 <span
class="math inline">\(z\)</span> 对内生变量 <span
class="math inline">\(x\)</span> 显著性</li>
</ul>
<h5 id="外生性的假设检验"><strong>2.1.2 外生性的假设检验</strong></h5>
<p>含义：结果变量 <span class="math inline">\(y\)</span> 与工具变量
<span class="math inline">\(z\)</span>
之间无关联，或者说无直接关联。</p>
<ul>
<li>无关联情况：<code>reg y z</code>​，<span
class="math inline">\(z\)</span> 不显著</li>
<li>无直接关联情况：<code>reg y z</code>​，<span
class="math inline">\(z\)</span> 显著；<code>reg y x z</code>​，<span
class="math inline">\(z\)</span> 不显著。说明 <span
class="math inline">\(z\)</span> 的显著性来仅自于 <span
class="math inline">\(x\)</span>。（<a
href="https://fgzfgz.github.io/posts/15538/">Link</a>）</li>
</ul>
<p>第二种“无直接关联情况”，需要注意的是，<strong>​<code>reg y x z</code>​</strong>​
<strong>，</strong>​<strong><span
class="math inline">\(z\)</span></strong>
<strong>不显著，是外生性假设成立的充分非必要条件</strong>​
<strong>！</strong> （<a
href="https://fgzfgz.github.io/posts/15538/">赵西亮，2017，《基本有用的计量经济学》</a>）</p>
<ul>
<li><strong>充分：</strong>​<code>reg y x z</code>​，<span
class="math inline">\(z\)</span> 不显著，说明 <span
class="math inline">\(z\)</span> 的显著性来仅自于 <span
class="math inline">\(x\)</span>，外生性成立。</li>
<li><strong>非必要：</strong>​<code>reg y x z</code>​，<span
class="math inline">\(z\)</span> 显著，<strong>不能说明</strong>
<strong><span class="math inline">\(z\)</span></strong>
<strong>不满足外生性</strong>。</li>
</ul>
<h5 id="排他性的假设检验"><strong>2.1.3 排他性的假设检验</strong></h5>
<p>在传统的因果推断相关教材中，并不包含排他性的这一假设。排他性假设本质是外生性假设的外延。</p>
<p>当工具变量满足外生性的充分条件（“无直接关联”情况）时，一般情况下无需进行排他性检验。然而，外生性的充分条件尝尝难以满足。通过排他性来论证工具变量
<span class="math inline">\(z\)</span> 对结果变量 <span
class="math inline">\(y\)</span> 的影响仅来自内生变量 <span
class="math inline">\(x\)</span>，就是一种可选的做法。</p>
<ul>
<li>排除其他影响路径的做法：<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/d4e7734f4d10d.html">经典文献</a>​</li>
<li>控制函数法下的排他性检验：<code>testex</code>​，<a
target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/SmBVZJRidQslE5TkP28ojg?spm_id_from=444.41.rich-text.link.click&amp;poc_token=HBhhkmajpMhPbctPNnBfdQeO-2viZZzjn1EmXQZl">链接</a></li>
</ul>
<h4 id="面板数据的工具变量假设检验">2.2 面板数据的工具变量假设检验</h4>
<p>滞后项做工具变量的前提（<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/news/c45f6113e2c2a.html">链接</a>）：</p>
<ul>
<li>不可观测因素不存在序列相关：<span class="math inline">\(U_{t-1}
\nrightarrow U_t\)</span>，无法检验</li>
<li>内生变量是平稳的自回归过程：<span class="math inline">\(X_{t-1}
\rightarrow X_t\)</span>，可以检验</li>
</ul>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/image-20240713200118-j6uk6pq.png" style="width:550px" alt="面板数据中滞后项做工具变量的有向无环图" /></p>
<h4 id="常用工具变量的检验">2.3 常用工具变量的检验</h4>
<p><strong>同侪效应检验：</strong>​<code>snreghnet</code>​
可以考察模型的行异质性和列异质性。<code>snregenet</code>​
计算模型的两阶段工具变量估计，并采用野蛮自举计算标准误差。
<strong>(</strong>​<strong><a
target="_blank" rel="noopener" href="http://www.uone-tech.cn/ChinaStataConference2024/">2024 年 Stata
中国用户大会</a></strong>​ <strong>，目前尚未发布)</strong></p>
<h3 id="其他内生性与工具变量检验">3. 其他内生性与工具变量检验</h3>
<h4 id="遗漏变量检验">3.1 遗漏变量检验</h4>
<ul>
<li>Article: <a
target="_blank" rel="noopener" href="https://www.tandfonline.com/doi/full/10.1080/07350015.2016.1227711">Oster
E. Unobservable selection and coefficient stability: Theory and
evidence[J]. Journal of Business &amp; Economic Statistics, 2019, 37(2):
187-204.</a></li>
<li>Package: <a
target="_blank" rel="noopener" href="https://econpapers.repec.org/software/bocbocode/S457677.htm">PSACALC:
Stata module to calculate treatment effects and relative degree of
selection under proportional selection of observables and
unobservables</a></li>
</ul>
<p><strong>案例：</strong><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzbM-XMWq17Bq1X4-RXofhaIYkOQ3VuGBOSuH--qG0sr-G1tr4wDbhqH_YHXxkkQgecccuongfF5ojQggOr1jI6AcN6NMP9i4aeP65y8j71R8riC_QzuP9sFjvmBe7Mfm72IqpKcn71pdfGr7QMcqfNUtuAiYoufqwQYKQ9IHNHM5RZC1kMnOIp3&amp;uniplatform=NZKPT&amp;language=CHS">吴刚,钟钰.地块规模与化肥投入：减施逻辑及其证据[J].华中农业大学学报,2024,43(03):27-38.</a></p>
<p>为考察可能存在的遗漏变量及其对回归的影响，可以使用 Oster (2019)
的提出的做法进行稳健性检验。当模型可能存在不可观测变量时，可以使用 <span
class="math inline">\(β^{\*}=β^{\*} (R_{max},\delta)\)</span>
获得真实系数的一致估计，其中 <span
class="math inline">\(R_{max}\)</span>
表示所有不可观测变量均能够被观测时回归方程的最大拟合优度；<span
class="math inline">\(\delta\)</span>
为选择比例，用于衡量相较于可观测变量和不可观测变量分别同核心解释变量之间相关关系的强弱，<span
class="math inline">\(\delta=1\)</span>
表示可观测变量与不可观测变量同等重要。参考 Oster (2019) 的参数设置，设定
<span class="math inline">\(R_{max} =
1.3R\)</span>，即为当前回归方程拟合优度的 1.3
倍，然后采用以下两种方法进行检验：</p>
<ul>
<li>方法（1）：当 <span class="math inline">\(\delta=1\)</span> 时，计算
<span class="math inline">\(β^{\* }(R_{max},\delta)\)</span>，若 <span
class="math inline">\(β^{\*}\)</span> 落在了估计系数的 95%
置信区间内，则估计系数是稳健的；</li>
<li>方法（2）：当 <span class="math inline">\(\beta =0\)</span> 时，计算
<span class="math inline">\(\delta\)</span> 的取值，若 <span
class="math inline">\(\delta\)</span> 的取值大于临界值
1，则通过检验。</li>
</ul>
<p>检验结果如表 8 所示：</p>
<ul>
<li>当 <span class="math inline">\(R_{max} = 1.3R\)</span>，<span
class="math inline">\(\delta=1\)</span> 时，估计系数 <span
class="math inline">\(β^{\*}\)</span> 均落在 95%
置信区间内，由于置信区间不包括 0，且 <span
class="math inline">\(β^{\*}\)</span>
的估计结果符号为负，方法（1）检验通过；</li>
<li>当 <span class="math inline">\(R_{max} = 1.3R\)</span>，<span
class="math inline">\(\beta =0\)</span> 时，此时，<span
class="math inline">\(\delta &gt; 1\)</span>，方法（2）检验通过。</li>
</ul>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/image-20240714033713-2wxhs1y.png" style="width:550px" alt="遗漏变量检验" /></p>
<h4 id="近似外生工具变量检验">3.2 近似外生工具变量检验</h4>
<p>工具变量完全外生是一种理想状态，现实中估计模型仍然可能存在轻微的内生性问题。
由于工具变量的外生性难以检验，可以使用 <a
target="_blank" rel="noopener" href="https://www.jstor.org/stable/41349174">Conley et al. (2012)</a>
提出的近似零（local to zero, LTZ）和置信区间集合（union of confidence
intervals,
UCI），检验工具变量在近似外生的条件下估计结果是否具有稳健性。</p>
<p>使用 <code>plausexog</code> 命令（<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/details/496.html">连享会链接</a>），可以进行近似工具变量检验，包括置信区间方法（UCI）和近似零方法（LTZ）。</p>
<p><strong>案例：</strong><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzbM-XMWq17Bq1X4-RXofhaIYkOQ3VuGBOSuH--qG0sr-G1tr4wDbhqH_YHXxkkQgecccuongfF5ojQggOr1jI6AcN6NMP9i4aeP65y8j71R8riC_QzuP9sFjvmBe7Mfm72IqpKcn71pdfGr7QMcqfNUtuAiYoufqwQYKQ9IHNHM5RZC1kMnOIp3&amp;uniplatform=NZKPT&amp;language=CHS">吴刚,钟钰.地块规模与化肥投入：减施逻辑及其证据[J].华中农业大学学报,2024,43(03):27-38.</a></p>
<p>LTZ 的结果表明，地块规模对化肥施用强度与化肥施用效率的影响在 1%
水平上显著为负；使用 UCI
估计工具变量近似外生条件下置信区间，可以发现主回归的估计系数均落在 UCI
法计算出的置信区间内。
因此，当工具变量是近似外生时，估计结果仍然具有稳健性。</p>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/image-20240714032317-2hokv5u.png" style="width:550px" alt="近似外生工具变量检验" /></p>
<h2
id="五工具变量估计中外部有效性的讨论">五、工具变量估计中外部有效性的讨论</h2>
<blockquote>
<p>本节内容主要来自：<a
target="_blank" rel="noopener" href="https://www.lianxh.cn/details/634.html">连享会 - IV
估计中的外部有效性 (External Validity)</a></p>
</blockquote>
<h3 id="什么是外部有效应">1. 什么是外部有效应？</h3>
<h4 id="含义">1.1 含义</h4>
<p>在政策评估中，对政策效应的估计大多集中在处理效应为常数，或者说平均处理效应
(ATE)
的情形。此时，隐含地假设了因果效应具有同质性，即所有个体处理效应都一样。然而，如果放宽这个假设，引入处理效应的异质性，那么就需要考虑一个问题：当类似于以下情况发生变化时，研究结论是否会改变？</p>
<ul>
<li>当有新个体加入实验，研究结论是否会改变？</li>
<li>A 州减税政策的评估结果，是否能直接用来指导 B 州的减税政策设计？</li>
<li>如果不能直接使用，那么是否可以通过调整后使用？</li>
</ul>
<h4 id="案例">1.2 案例</h4>
<ul>
<li>研究一：利用随机抽取的参军资格作为工具变量
IV，来估计越战服役对收入的影响；</li>
<li>研究二：估计志愿参军人员的参军经历对收入的影响。</li>
</ul>
<p><strong>研究一的估计结果不能用在研究二中。</strong>
这是由于两个样本中个体并不相同，即研究一中更接近随机，而研究二中那些志愿参军的人员，可能本身就是收入偏低的劳动人群。</p>
<h3 id="局部平均处理效应-late">2. 局部平均处理效应 (LATE)</h3>
<p>在 IV
分析框架中，我们尝试通过引入工具变脸来创造因果链条：通过工具变量 Z
影响我们感兴趣的变量 <span class="math inline">\(D\)</span>，然后 <span
class="math inline">\(D\)</span> 再去影响潜在结果 <span
class="math inline">\(Y\)</span>。</p>
<p>需要注意的是，不论干预变量 <span class="math inline">\(D_i\)</span>
是何种类型，工具变量法的结果都不可作为因果效应（ATE），仅可将结果解释为局部平均处理效应（Local
Average Treatment Effect，LATE）。</p>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/net-img-image-20221018182903-oq4blvn-20221021221423-dp6aln3.png" style="width:550px" alt="工具变量法的有相无环图" /></p>
<p>在参军的例子中，工具变量 <span class="math inline">\(Z\)</span>
为随机抽取的参军资格，干预变量 <span class="math inline">\(D\)</span>
为是否参军，那么根据是否有参军资格、是否参军，可以将人群划分为四大类：</p>
<ul>
<li>如果有参军资格（<span
class="math inline">\(Z=1\)</span>），则参军（<span
class="math inline">\(D=1\)</span>）；</li>
<li>如果没有参军资格（<span
class="math inline">\(Z=0\)</span>），则不参军（<span
class="math inline">\(D=0\)</span>）；</li>
<li>如果没有参军资格（<span
class="math inline">\(Z=0\)</span>），也会参军（<span
class="math inline">\(D=1\)</span>）；</li>
<li>如果有参军资格（<span
class="math inline">\(Z=1\)</span>），也不参军（<span
class="math inline">\(D=0\)</span>）。</li>
</ul>
<p><strong>工具变量估计到底是对什么群人的估计？</strong></p>
<ul>
<li><p>IV
估计可以解释的两类人群（<strong>依从工具变量者，compliers</strong>）：</p>
<ul>
<li>如果有参军资格 (<span class="math inline">\(Z=1\)</span>)，则参军
(<span class="math inline">\(D=1\)</span> )；</li>
<li>如果没有参军资格 (<span
class="math inline">\(Z=0\)</span>)，则不参军 (<span
class="math inline">\(D=0\)</span>)。</li>
</ul></li>
<li><p>IV 估计不能解释的两类人均：</p>
<ul>
<li><strong>始终接受者（always-takers）：</strong>
不论是否有参军资格（<span class="math inline">\(Z=0 \ \ or \ \
Z=1\)</span>），都要参军（<span
class="math inline">\(D=1\)</span>）；</li>
<li><strong>始终不接受者（never-takers）：</strong>
不论是否有参军资格（<span class="math inline">\(Z=0 \ \ or \ \
Z=1\)</span>），都不参军（<span
class="math inline">\(D=0\)</span>）。</li>
</ul></li>
</ul>
<p>当依从工具变量者（compliers）只占实验人群一部分时：</p>
<ul>
<li>IV 估计出来平均因果效应往往不等于所有 <span
class="math inline">\(D=1\)</span> 的人的平均处理效应；</li>
<li>IV 估计出来的未受处理的个体的平均处理效应也不等于所有 <span
class="math inline">\(D=0\)</span> 的人的平均处理效应。</li>
</ul>
<h3 id="late-的外部有效性">3. LATE 的外部有效性</h3>
<p>当随机实验中不只是 compliers
人群时，如何在工具变量局部因果框架下，去估计所有实验组个体的平均因果效应呢？或者说，如何评估该实验中
LATE 的外部有效性呢？</p>
<p>利用异质性因果效应和边际处理效应 (MTE) 可以识别 IV
估计下的内部效度和外部效度（外部有效性）问题。</p>
<h4 id="边际处理效应">3.1 边际处理效应</h4>
<p>Kowalski 编写了 <code>mtebinary</code>​ 和 <code>mtemore</code>
​命令，用于估计二元工具变量下的边际处理效应。</p>
<blockquote>
<p>[1] <a
target="_blank" rel="noopener" href="https://ideas.repec.org/c/boc/bocode/s458285.html">Kowalski A,
Tran Y, Ristovska L. MTEBINARY: Stata module to compute Marginal
Treatment Effects (MTE) With a Binary Instrument, Statistical Software
Components, 2018.</a></p>
<p>[2] <a
target="_blank" rel="noopener" href="https://ideas.repec.org/c/boc/bocode/s458503.html">Kowalski A,
Tran Y, Ristovska L. MTEMORE: Stata module to compute Marginal Treatment
Effects (MTE) With a Binary Instrument, Statistical Software Components,
2018.</a></p>
</blockquote>
<blockquote>
<p><strong>工具变量是一种思想：</strong>
工具变量的边际处理效应，是结合了二元变量的边际效应估计和工具变量解决内生性的思路。</p>
</blockquote>
<h3 id="删失数据的工具变量分位数回归">3.2
删失数据的工具变量分位数回归</h3>
<p>在内生性或外生性情况下，使用 <code>cqiv</code>
​命令，可以估计删失和未删失数据数据的估计。</p>
<blockquote>
<p><strong>工具变量是一种思想：</strong>
结合分位数回归和工具变量估计，可以在删失数据和未删失数据中考察异质性的因果效应估计。</p>
<p>文献来源：<a
target="_blank" rel="noopener" href="https://journals.sagepub.com/doi/10.1177/1536867X19893615">Chernozhukov
V, Fernández-Val I, Han S, et al. Censored quantile
instrumental-variable estimation with Stata[J]. The Stata Journal, 2019,
19(4): 768-781.</a></p>
</blockquote>
<h4 id="拓展材料">3.3 拓展材料：</h4>
<ul>
<li>政策干预的外部有效应问题的文献回归：<a
target="_blank" rel="noopener" href="https://www.opensaldru.uct.ac.za/handle/11090/691">Muller S.
Randomised trials for policy: a review of the external validity of
treatment effects[M]. 2014.</a></li>
<li>政策干预中，分析基于工具变量的始终接受者和始终不接受者的外部有效性检验：<a
target="_blank" rel="noopener" href="https://www.cambridge.org/core/journals/political-analysis/article/profiling-compliers-and-noncompliers-for-instrumentalvariable-analysis/0E2AA51F9BD436A5DB5A84462732A9C3">Marbach
M, Hangartner D. Profiling compliers and noncompliers for
instrumental-variable analysis[J]. Political Analysis, 2020, 28(3):
435-444.</a></li>
</ul>
<h4 id="为什么普适性">3.4 为什么？普适性？</h4>
<p><strong>问题一：</strong> 为什么要考察 LATE 的外部有效性？</p>
<p>上面的很多回答都在尝试估计准确的二元政策干预效果。</p>
<ul>
<li><p>LATE
的本质是忽略异质性影响得到的估计，主要关注估计结果的内部有效性；</p></li>
<li><p>LATE 的外部有效性，本质是关注异质性干预行为：</p>
<ul>
<li>干预行为的异质性：参军的例子中，考察随机抽取下受试群体的自选择行为，本质是其他未控制因素的异质性；</li>
<li>结果的异质性：<code>cqiv</code>
​命令的例子中，考察（结果变量的）不同分位点处的异质性影响。</li>
</ul></li>
<li><p>结合机器学习的例子：张宏亮（2014,
JDE）的例子，针对留守儿童随机干预的差异，结果“是否女孩儿”和“基线成绩”是影响干预行为效果的重要因素。</p></li>
</ul>
<p><strong>问题二：</strong> 为什么要针对二元干预变量考虑
LATE？在连续的干预行为里，没有普适性吗？</p>
<ul>
<li><p>在二元干预的估计里，将估计结果解释为因果效应已经尤为困难；在连续干预的估计里，估计结果更加难以解释为因果效应。</p></li>
<li><p>二元干预估计的外部有效性讨论，对连续干预估计的最大启发是：</p>
<ul>
<li>需要关注工具变量和内生干预行为的相关性，工具变量包含内生变量的信息较少会导致弱工具变量问题，降低估计结果的可信度；</li>
<li>连续干预估计中，工具变量既与内生干预变量相关、又与结果变量不直接相关非常困难。因此，多数工具变量往往不够外生，要关注工具变量的外生性检验。</li>
</ul></li>
</ul>
<p><strong>外部有效性是回归方法的固有问题，难以完全回避。在解决外部有效性问题上</strong>，<strong>擅长预测的机器学习是否有更好的表现？</strong></p>
<h2 id="外部有效性识别的-stata-命令">4. 外部有效性识别的 Stata 命令</h2>
<h3 id="针对二元工具变量的边际效应估计mtebinary-命令">4.1
针对二元工具变量的边际效应估计：<code>mtebinary</code>​ 命令</h3>
<h4 id="命令简介">4.1.1 命令简介</h4>
<p><code>mtebinary</code>​ 命令安装如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssc</span> install mtebinary, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<p><code>mtebinary</code> ​的语法格式为：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mtebinary outcome  (endogvar = instrumen)  [covariates] [, options]</span><br></pre></td></tr></table></figure>
<p>其中，</p>
<ul>
<li><code>outcome</code>​ 为结果变量，可以是二元、离散或者连续变量；</li>
<li><code>endogvar</code>​ 为内生变量，必须是二元变量；</li>
<li><code>instrument</code>​ 为工具变量，必须是二元变量；</li>
<li><code>covariates</code>​ 为协变量。</li>
</ul>
<p><code>opitions</code>​ 主要包括两类：</p>
<ul>
<li><p>第一类为 <code>Estimation</code>​ 设置的选项，其中，</p>
<ul>
<li><code>poly(#)</code>​ 括号里填估计时回归函数的幂，默认为 1
次，即线性；</li>
<li><code>reps(#)</code>​ 括号里填 <code>bootstrap</code>​ 的次数，默认为
200；</li>
<li><code>seed(#)</code>​ 括号里填 <code>bootstrap</code>​
的随机种子数，默认是 6574358；</li>
<li><code>bootsample(opt)</code>​ 括号里填 <code>bootstrap</code>​
的方式，可以是
<code>strata(varlist)</code>​，<code>cluster(varlist)</code>​，或者
<code>weight</code>​；</li>
<li><code>weightvar(varname)</code>​
括号里填需要赋予权重的变量名，默认没有赋予权重；</li>
</ul></li>
<li><p>第二类为 <code>Post-Estimation</code>​ 的相关选项，其中，</p>
<ul>
<li><code>summarize(varlist)</code>​
括号里填协变量名称，输出这些协变量的三类人群的统计描述；</li>
<li><code>graphsave(graphsave)</code>​ 括号里填输出图像的名称，默认名称为
mtegrapha。</li>
</ul></li>
</ul>
<h4 id="命令用法示例">4.1.2 命令用法示例</h4>
<p>下面以没有协变量、MTE
效应为线性为例来展示命令的用法和结果。相关代码如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">net</span> get mtebinary       <span class="comment">//下载数据 mtebinary_data.dta 到当前文件夹</span></span><br><span class="line"><span class="keyword">use</span> mtebinary_data.dta, <span class="keyword">clear</span></span><br><span class="line">mtebinary Y2 (<span class="keyword">D</span> = Z), reps (0) <span class="keyword">summarize</span> (age female) graphsave (mte)</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>Y2</code>​ 为急救室使用情况，<code>D</code>​
为是否接受医疗服务，<code>Z</code>​ 为是否有资格医疗补助；</li>
<li><code>reps(0)</code>​ 表示 <code>bootstrap</code>​ 次数为 0；</li>
<li><code>summarize(age female)</code>​ 表示显示 compliers、always-takers
和 never-takers 这三类人群的 <code>age</code>​ 和 <code>female</code>​
的统计性质；</li>
<li><code>graphsave (mte)</code>​ 将图形结果保存名为 mte 的 pdf
文件。</li>
</ul>
<p>主要回归结果为三个表和两个图，具体来看。</p>
<p>第一个表格为 "Average Characteristics of Always Takers, Compliers and
Never Takers"，如下所示。其中第一列显示了所有人群的结果，第二列显示了
always-takers 人群的结果，第三列显示了 never-takers 人群的结果，第四列为
always-takers 人群和 compliers 人群的差异，第五列为 compliers 人群和
never-takers 人群的差异。从变量的统计结果，可以计算出 <span
class="math inline">\(P_C=175/500=0.375\)</span>，<span
class="math inline">\(P_I=0.375+125/500=0.625\)</span>。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Beginning Estimation of Marginal Treatment Effects (MTE) with a Binary Instrument.</span><br><span class="line">MTE has been specified <span class="keyword">as</span> a polynomial of <span class="keyword">order</span> 1.</span><br><span class="line">The number of <span class="keyword">bootstrap</span> replication is 0</span><br><span class="line"><span class="keyword">NOTE</span>: <span class="variable">$Y</span><span class="variable">$ou</span> have specified zero <span class="keyword">bootstrap</span> replication. <span class="keyword">No</span> standard <span class="keyword">error</span> will be computed</span><br><span class="line"></span><br><span class="line">Average Characteristics of Always Takers, Compliers and Never Takers</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">           All     (1)       (2)      (3)    Differences  </span><br><span class="line">                  Always  Compliers  Never     (1)-(2)    (2)-(3) </span><br><span class="line">                  Takers             Takers               </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"> age      49.25   54.32    50.00     44.65      4.32       5.35   </span><br><span class="line"> female    0.56    0.27     1.00      0.79      -0.73      0.21   </span><br><span class="line"> <span class="keyword">Count</span>   500.00  175.00   125.00    200.00               </span><br><span class="line">-------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>可以发现，不同类型人群间存在较为明显的统计差异。比如对于年龄而言，always-takers
人群年平均龄大于 compliers 人群 4.32 岁，约 8.6%；而 compliers
人群年龄平均大于 never-takers 人群 5.35 岁，约
10.67%。在这里，always-takers
人群最大，他们本身对医疗补助的需求也最大，而 never-takers
人群年龄最小，他们对医疗补助需求最小。</p>
<p>实际上，他们是否参与，部分可能是逆向选择的结果。可见，如果忽略不同类别间人群的显著差异，将
LATE
效应当成全部人群的平均处理效应，很有可能导致高估或低估的错误。同样，性别变量的组间差异也存在类似的性质。</p>
<p>第二个表格为 "Marginal Treated Outcome, Untreated Outcome, and
Treatment
Effect"，分别给出了三种效应的斜率和截距。有了斜率和截距，我们就可以将仅适用于
compliers 人群的 LATE 效应外推到 never-takers 人群和 always-takers
人群。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Marginal Treated Outcome, Untreated Outcome, and Treatment Effect</span><br><span class="line">           ---------------------------</span><br><span class="line">                  Intercept   Slope  </span><br><span class="line">           ---------------------------</span><br><span class="line">            MTO    965.00    -600.00 </span><br><span class="line">            MUO    550.00    -400.00 </span><br><span class="line">            MTE    415.00    -200.00 </span><br><span class="line">           ---------------------------</span><br></pre></td></tr></table></figure>
<p>第三个表格为 "Average Outcome of Always Takers, Compliers, and Never
Takers"，给出不同人群的处理效应和非处理效应。计算方法为利用第二个表
中的结果，分别计算 MTO，MUO 和 MTE 在 <span class="math inline">\([0,
P_C]\)</span>，<span class="math inline">\([P_C, P_I]\)</span>，<span
class="math inline">\([P_C, 1]\)</span> 三个区间上的期望。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Average Outcome of Always Takers, Compliers, and Never Takers</span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line">                     Always  Compliers  Never    Untreated      Treated  </span><br><span class="line">                     Takers             Takers  Outcome <span class="keyword">Test</span>  Outcome <span class="keyword">Test</span> </span><br><span class="line">                      (1)       (2)      (3)      (2)-(3)       (1)-(2)  </span><br><span class="line">----------------------------------------------------------------------------</span><br><span class="line"> Treated Outcome     860.00   680.00    485.00                   180.00  </span><br><span class="line"> Untreated Outcome   480.00   360.00    230.00     130.00            </span><br><span class="line"> Treatment Effect    380.00   320.00    255.00                       </span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>对于 IV 计算出来的 LATE，在这里就等于第（2）列中 <span
class="math inline">\(680-360=320\)</span>。我们同样可以用 IV
回归方法来检验一下结果是否相符。IV 回归的语法和结果如下所示，再次验证了
IV 回归结果仅仅是识别了 compliers 人群的处理效应。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">. ivregress 2sls Y2 (<span class="keyword">D</span>=Z)</span><br><span class="line"></span><br><span class="line">Instrumental variables (2SLS) regression </span><br><span class="line">                                         Number of obs =    500</span><br><span class="line">                                         Wald <span class="built_in">chi2</span>(1)  =  52.50</span><br><span class="line">                                         <span class="keyword">Prob</span> &gt; chi2   = 0.0000</span><br><span class="line">                                         R-squared     = 0.8103</span><br><span class="line">                                         Root MSE      = 120.95</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">    Y2 |   Coef.  Std. <span class="keyword">Err</span>.    z    P&gt;|z|  [95% <span class="keyword">Conf</span>. Interval]</span><br><span class="line">-------+-------------------------------------------------------</span><br><span class="line">     <span class="keyword">D</span> | 320.000    44.165   7.25   0.000   233.439     406.561</span><br><span class="line"> _cons | 371.000    20.597  18.01   0.000   330.631     411.369</span><br><span class="line">---------------------------------------------------------------</span><br><span class="line">Instrumented:  <span class="keyword">D</span></span><br><span class="line">Instruments:   Z</span><br></pre></td></tr></table></figure>
<p>此外，回归结果还包含了两个图形，如下所示。左图为 "Average
outcomes"，对应第三个表的结果。右图为 "MTO(p), MUO(p),
MTE(p)"，对应第二个表的结果。观察右图，利用处理效应连续性的假定，对于始终
<span class="math inline">\(D\)</span>=1 的 always
Takers，我们也能获得出他的对照组结果 MUO(p) 和处理效应
MTE(p)。而对于始终 <span class="math inline">\(D\)</span>=0 的 never
Takers，我们也能获得他的实验组结果 MTO(p) 和处理效应 MTE(p)。</p>
<p><img src="https://assets.b3logfile.com/siyuan/1634272634187/assets/net-img-MTEbinary：LATE效应的外部效度_Fig2_命令结果_张子楠-20240726104139-umly9bm.png" style="width:700px" alt="近似外生工具变量检验" /></p>
<h3 id="针对二元工具变量的边际处理效应估计mtemore-命令">4.2
针对二元工具变量的边际处理效应估计：<code>mtemore</code>​ 命令</h3>
<p><code>mtemore</code>​ 命令安装如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssc</span> install mtemore, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<p><code>mtemore</code>​ 命令语法如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mtemore outcome (endogvar = instrument) [covariates] [, options]</span><br></pre></td></tr></table></figure>
<p>需要注意的是，<code>mtemore</code>​ 中 <code>bootstrap</code>​
次数不能为 0，最低为 2 次。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> mtebinary_data.dta, <span class="keyword">clear</span></span><br><span class="line">mtemore Y2 (<span class="keyword">D</span> = Z), <span class="keyword">summarize</span>(age female) reps(2) graphsave(mtemore)</span><br></pre></td></tr></table></figure>
<h3 id="针对删失数据的工具变量分位数估计cqiv-命令">4.3
针对删失数据的工具变量分位数估计：<code>cqiv</code>​ 命令</h3>
<p><code>cqiv</code>​ 命令安装如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssc</span> install cqiv, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<p><code>cqiv</code>​ 命令语法如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cqiv depvar [<span class="keyword">varlist</span>] (endogvar = instrument) [<span class="keyword">if</span>] [<span class="keyword">in</span>] [weight] [, options]</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">net</span> get cqiv   <span class="comment">//下载数据 alcoholengel.dta 到当前文件夹</span></span><br><span class="line"><span class="keyword">use</span> alcoholengel, <span class="keyword">clear</span></span><br><span class="line">cqiv alcohol logexp2 nkids (logexp = logwages nkids), quantiles(25 50 75)</span><br></pre></td></tr></table></figure>
<h2 id="六重要资料和参考链接汇总">六、重要资料和参考链接汇总</h2>
<ul>
<li><a
target="_blank" rel="noopener" href="https://sangmino.notion.site/1a897b8106ca44eeaf31dcd5ae5a61b1?v=ff7dc75862c6427eb4243e91836e077e">[Notion
笔记 - Sangmino] 超过 1600
篇外文顶刊文章的工具变量汇总，还在动态更新!</a></li>
<li><a target="_blank" rel="noopener" href="https://www.lianxh.cn/details/1351.html">[连享会] IV
的标准动作：工具变量法实用指南</a></li>
<li><a
target="_blank" rel="noopener" href="https://kns.cnki.net/kcms2/article/abstract?v=YRsOmSesWzYrUgQrir9hfnlRovRrfAFci4ESQpFVDHJgUc_AxYgcsbQY6_zjz5LdRsDXMyW3DPLDiPOrrTJC7DzoK0M-0FQoJjljRn6cidyM9c2pzGVacHj2hKv7SLpnFjk_K88abNWclQTOyYi9RfqJgxkPxRWJ&amp;uniplatform=NZKPT&amp;language=CHS">[两阶段模型的比较]
赵娜,洪广彬.多项分布内生回归元计数模型的两阶段估计方法研究[J].统计与信息论坛,2018,33(08):19-30.</a></li>
<li><a target="_blank" rel="noopener" href="https://www.lianxh.cn/details/634.html">连享会 - IV
估计中的外部有效性 (External Validity)</a></li>
</ul>
<p>‍</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://fgzfgz.github.io">FGZ</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://fgzfgz.github.io/posts/32992/">https://fgzfgz.github.io/posts/32992/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">转载请联系作者，并注明文章来源 <a href="https://fgzfgz.github.io" target="_blank">https://fgzfgz.github.io</a></span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E8%AF%81%E5%88%86%E6%9E%90/">实证分析</a><a class="post-meta__tags" href="/tags/Stata/">Stata</a><a class="post-meta__tags" href="/tags/%E5%91%BD%E4%BB%A4/">命令</a><a class="post-meta__tags" href="/tags/%E4%BB%A3%E7%A0%81/">代码</a><a class="post-meta__tags" href="/tags/%E7%9B%B8%E5%85%B3%E6%80%A7/">相关性</a><a class="post-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F/">工具变量</a><a class="post-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C/">工具变量检验</a><a class="post-meta__tags" href="/tags/%E9%81%97%E6%BC%8F%E5%8F%98%E9%87%8F/">遗漏变量</a><a class="post-meta__tags" href="/tags/%E8%BF%91%E4%BC%BC%E5%A4%96%E7%94%9F%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F/">近似外生工具变量</a><a class="post-meta__tags" href="/tags/%E5%A4%96%E7%94%9F%E6%80%A7/">外生性</a></div><div class="post_share"><div class="social-share" data-image="/img/topimage.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1706/" title="实证｜双重差分法的安慰剂检验"><img class="cover" src="/img/topimage.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">实证｜双重差分法的安慰剂检验</div></div></a></div><div class="next-post pull-right"><a href="/posts/47822/" title="实证｜变系数随机前沿分析的简明教程"><img class="cover" src="/img/topimage.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">实证｜变系数随机前沿分析的简明教程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/18383/" title="实证｜用outreg2命令导出计量结果"><img class="cover" src="/img/topimage.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-11</div><div class="title">实证｜用outreg2命令导出计量结果</div></div></a></div><div><a href="/posts/1706/" title="实证｜双重差分法的安慰剂检验"><img class="cover" src="/img/topimage.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-26</div><div class="title">实证｜双重差分法的安慰剂检验</div></div></a></div><div><a href="/posts/1638/" title="实证｜相关性、共线性检验"><img class="cover" src="/img/topimage.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-16</div><div class="title">实证｜相关性、共线性检验</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">FGZ</div><div class="author-info__description">道阻且长，行则将至</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">91</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/455889108"><i class="fas fa-brands fa-bilibili"></i><span>  关      注</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95%E5%8E%9F%E7%90%86"><span class="toc-text">一、工具变量法原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%A0%E6%9E%9C%E6%8E%A8%E6%96%AD%E4%B8%AD%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">1. 因果推断中的工具变量法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%9B%A0%E6%9E%9C%E6%8E%A8%E6%96%AD%E4%B8%AD%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">2. 非因果推断中的工具变量法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="toc-text">二、常用的工具变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%AA%E9%9D%A2%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="toc-text">1. 截面数据中常用的工具变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E6%88%96%E5%9C%B0%E7%90%86%E7%89%B9%E5%BE%81"><span class="toc-text">1.1 自然或地理特征</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E7%89%B9%E5%BE%81"><span class="toc-text">1.2 关联特征</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E%E5%86%85%E7%94%9F%E5%8F%98%E9%87%8F%E5%85%B3%E8%81%94"><span class="toc-text">1.2.1 与内生变量关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E%E5%8F%97%E8%AE%BF%E4%B8%AA%E4%BD%93%E5%85%B3%E8%81%94"><span class="toc-text">1.2.2 与受访个体关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8C%E4%BE%AA%E6%95%88%E5%BA%94"><span class="toc-text">1.3 同侪效应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E6%9D%BF%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="toc-text">2. 面板数据中常用的工具变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E5%8F%98%E5%8F%98%E9%87%8F%E4%BD%9C%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="toc-text">2.1 时变变量作工具变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E6%97%B6%E5%8F%98%E5%8F%98%E9%87%8F%E4%BD%9C%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F"><span class="toc-text">2.2 非时变变量作工具变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">三、常用的工具变量法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%B8%A4%E6%AD%A5%E4%BC%B0%E8%AE%A1%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">1. 基于两步估计的工具变量法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E4%B8%BA%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%A4%E9%98%B6%E6%AE%B5%E4%BC%B0%E8%AE%A1%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%952sls"><span class="toc-text">1.1
最为常见的两阶段估计：两阶段最小二乘法（2SLS）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BF%AE%E6%AD%A3%E4%B8%8E%E8%A1%A5%E5%85%852sps-%E4%B8%8E-2sri"><span class="toc-text">1.2
两阶段模型的修正与补充：2SPS 与 2SRI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%AE%8B%E5%B7%AE%E5%8C%85%E5%90%AB%E6%B3%95twostage-residual-inclusion-2sri"><span class="toc-text">1.3
两阶段残差包含法（Twostage Residual Inclusion, 2SRI）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%94%9F%E8%BD%AC%E6%8D%A2%E6%A8%A1%E5%9E%8B-esr"><span class="toc-text">2. 内生转换模型 ESR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B-erm"><span class="toc-text">3. 拓展回归模型 ERM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%B3%95"><span class="toc-text">4. 其他工具变量法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E7%9A%84%E6%A3%80%E9%AA%8C"><span class="toc-text">四、工具变量的检验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%A3%80%E9%AA%8C%E9%A1%B9%E7%9B%AE%E5%9B%9B%E5%A4%A7%E9%A1%B9%E7%9B%AE"><span class="toc-text">1. 常见检验项目：四大项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-text">1.1 命令：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ivregress-2sls-%E4%B8%8B%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C%E7%A4%BA%E4%BE%8B"><span class="toc-text">1.2
​ivregress 2SLS​​
下的工具变量检验示例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ivreg2-%E4%B8%8B%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C%E7%A4%BA%E4%BE%8B"><span class="toc-text">1.3
​ivreg2​​
下的工具变量检验示例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E7%9A%84%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.工具变量的假设检验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%AA%E9%9D%A2%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.1 截面数据的工具变量假设检验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E7%9A%84%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.1.1 相关性的假设检验</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E7%94%9F%E6%80%A7%E7%9A%84%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.1.2 外生性的假设检验</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E4%BB%96%E6%80%A7%E7%9A%84%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.1.3 排他性的假设检验</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E6%9D%BF%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E5%81%87%E8%AE%BE%E6%A3%80%E9%AA%8C"><span class="toc-text">2.2 面板数据的工具变量假设检验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E7%9A%84%E6%A3%80%E9%AA%8C"><span class="toc-text">2.3 常用工具变量的检验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%86%85%E7%94%9F%E6%80%A7%E4%B8%8E%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C"><span class="toc-text">3. 其他内生性与工具变量检验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%97%E6%BC%8F%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C"><span class="toc-text">3.1 遗漏变量检验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%91%E4%BC%BC%E5%A4%96%E7%94%9F%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E6%A3%80%E9%AA%8C"><span class="toc-text">3.2 近似外生工具变量检验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E4%BC%B0%E8%AE%A1%E4%B8%AD%E5%A4%96%E9%83%A8%E6%9C%89%E6%95%88%E6%80%A7%E7%9A%84%E8%AE%A8%E8%AE%BA"><span class="toc-text">五、工具变量估计中外部有效性的讨论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%96%E9%83%A8%E6%9C%89%E6%95%88%E5%BA%94"><span class="toc-text">1. 什么是外部有效应？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AB%E4%B9%89"><span class="toc-text">1.1 含义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">1.2 案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%B9%B3%E5%9D%87%E5%A4%84%E7%90%86%E6%95%88%E5%BA%94-late"><span class="toc-text">2. 局部平均处理效应 (LATE)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#late-%E7%9A%84%E5%A4%96%E9%83%A8%E6%9C%89%E6%95%88%E6%80%A7"><span class="toc-text">3. LATE 的外部有效性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%B9%E9%99%85%E5%A4%84%E7%90%86%E6%95%88%E5%BA%94"><span class="toc-text">3.1 边际处理效应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E5%88%86%E4%BD%8D%E6%95%B0%E5%9B%9E%E5%BD%92"><span class="toc-text">3.2
删失数据的工具变量分位数回归</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E6%9D%90%E6%96%99"><span class="toc-text">3.3 拓展材料：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%99%AE%E9%80%82%E6%80%A7"><span class="toc-text">3.4 为什么？普适性？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E6%9C%89%E6%95%88%E6%80%A7%E8%AF%86%E5%88%AB%E7%9A%84-stata-%E5%91%BD%E4%BB%A4"><span class="toc-text">4. 外部有效性识别的 Stata 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8C%E5%85%83%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E7%9A%84%E8%BE%B9%E9%99%85%E6%95%88%E5%BA%94%E4%BC%B0%E8%AE%A1mtebinary-%E5%91%BD%E4%BB%A4"><span class="toc-text">4.1
针对二元工具变量的边际效应估计：mtebinary​ 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E7%AE%80%E4%BB%8B"><span class="toc-text">4.1.1 命令简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="toc-text">4.1.2 命令用法示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8C%E5%85%83%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E7%9A%84%E8%BE%B9%E9%99%85%E5%A4%84%E7%90%86%E6%95%88%E5%BA%94%E4%BC%B0%E8%AE%A1mtemore-%E5%91%BD%E4%BB%A4"><span class="toc-text">4.2
针对二元工具变量的边际处理效应估计：mtemore​ 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%88%A0%E5%A4%B1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B7%A5%E5%85%B7%E5%8F%98%E9%87%8F%E5%88%86%E4%BD%8D%E6%95%B0%E4%BC%B0%E8%AE%A1cqiv-%E5%91%BD%E4%BB%A4"><span class="toc-text">4.3
针对删失数据的工具变量分位数估计：cqiv​ 命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E9%87%8D%E8%A6%81%E8%B5%84%E6%96%99%E5%92%8C%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%E6%B1%87%E6%80%BB"><span class="toc-text">六、重要资料和参考链接汇总</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最近更新</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/38591/" title="教对象Stata系列｜第1课代码：软件介绍与数据管理"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="教对象Stata系列｜第1课代码：软件介绍与数据管理"/></a><div class="content"><a class="title" href="/posts/38591/" title="教对象Stata系列｜第1课代码：软件介绍与数据管理">教对象Stata系列｜第1课代码：软件介绍与数据管理</a><time datetime="2025-07-26T14:50:00.840Z" title="更新于 2025-07-26 22:50">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38617/" title="教对象Stata系列｜第1课：软件介绍与数据管理"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="教对象Stata系列｜第1课：软件介绍与数据管理"/></a><div class="content"><a class="title" href="/posts/38617/" title="教对象Stata系列｜第1课：软件介绍与数据管理">教对象Stata系列｜第1课：软件介绍与数据管理</a><time datetime="2025-07-26T14:50:00.492Z" title="更新于 2025-07-26 22:50">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/25529/" title="实证｜主成分分析"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜主成分分析"/></a><div class="content"><a class="title" href="/posts/25529/" title="实证｜主成分分析">实证｜主成分分析</a><time datetime="2025-07-26T14:50:00.007Z" title="更新于 2025-07-26 22:50">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18383/" title="实证｜用outreg2命令导出计量结果"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜用outreg2命令导出计量结果"/></a><div class="content"><a class="title" href="/posts/18383/" title="实证｜用outreg2命令导出计量结果">实证｜用outreg2命令导出计量结果</a><time datetime="2025-07-26T14:49:59.660Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1638/" title="实证｜相关性、共线性检验"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜相关性、共线性检验"/></a><div class="content"><a class="title" href="/posts/1638/" title="实证｜相关性、共线性检验">实证｜相关性、共线性检验</a><time datetime="2025-07-26T14:49:59.249Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/19130/" title="实证｜为什么使用PSM消除样本选择偏差？"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜为什么使用PSM消除样本选择偏差？"/></a><div class="content"><a class="title" href="/posts/19130/" title="实证｜为什么使用PSM消除样本选择偏差？">实证｜为什么使用PSM消除样本选择偏差？</a><time datetime="2025-07-26T14:49:58.952Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/15857/" title="实证｜统计分析"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜统计分析"/></a><div class="content"><a class="title" href="/posts/15857/" title="实证｜统计分析">实证｜统计分析</a><time datetime="2025-07-26T14:49:58.484Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1706/" title="实证｜双重差分法的安慰剂检验"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜双重差分法的安慰剂检验"/></a><div class="content"><a class="title" href="/posts/1706/" title="实证｜双重差分法的安慰剂检验">实证｜双重差分法的安慰剂检验</a><time datetime="2025-07-26T14:49:58.162Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/21172/" title="实证｜双重差分 (DID) 的四个假设"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜双重差分 (DID) 的四个假设"/></a><div class="content"><a class="title" href="/posts/21172/" title="实证｜双重差分 (DID) 的四个假设">实证｜双重差分 (DID) 的四个假设</a><time datetime="2025-07-26T14:49:57.677Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/33541/" title="实证｜熵权法"><img src="/img/topimage.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实证｜熵权法"/></a><div class="content"><a class="title" href="/posts/33541/" title="实证｜熵权法">实证｜熵权法</a><time datetime="2025-07-26T14:49:57.374Z" title="更新于 2025-07-26 22:49">2025-07-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/topimage.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By FGZ</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'jsVAsGoLh4uzI2G5L4KNVxy4-gzGzoHsz',
      appKey: 'O0Kgf1B5rJVcWBvt1vVvsRQd',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.sukap.cn/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>